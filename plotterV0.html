<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Clipboard Processor</title>
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
    />

 <style>
        body {
            font-family: "Segoe UI", Arial, sans-serif;
            background: #f6f8fa;
            margin: 0;
            padding: 24px;
        }
        .btn {
            background: #1976d2;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 10px 18px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(25, 118, 210, 0.12);
            transition: background 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 20px;
        }
        .btn:hover {
            background: #115293;
            box-shadow: 0 4px 16px rgba(25, 118, 210, 0.18);
        }
        #output {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            min-height: 100px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>

    
    <button class="btn" id="btnProcess"><i class="fa-solid fa-clipboard"></i> Process Clipboard</button>
    <button class="btn" id="btnTest"><i class="fa-solid fa-vial"></i> Test with Sample Data</button>
    <button class="btn" id="btnCopy"><i class="fa-solid fa-copy"></i> Copy Result to Clipboard</button>
    
    <div id="status"></div>
    <div id="output"></div>

    <script>
        let processedResult = null;

        function parseTabSeparatedData(text) {
            const lines = text.split(/\r?\n/);
            const rows = [];
            let currentRow = [];
            let cellContent = '';
            let inQuotedCell = false;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                let j = 0;
                
                while (j < line.length) {
                    const char = line[j];
                    
                    if (!inQuotedCell && char === '\t') {
                        // End of cell
                        currentRow.push(cellContent);
                        cellContent = '';
                    } else if (char === '"') {
                        // Toggle quoted cell state
                        inQuotedCell = !inQuotedCell;
                    } else {
                        // Add character to current cell content
                        cellContent += char;
                    }
                    j++;
                }
                
                // Check if we're at the end of a row (not in a quoted cell)
                if (!inQuotedCell) {
                    // Add the last cell of the row
                    currentRow.push(cellContent);
                    rows.push(currentRow);
                    currentRow = [];
                    cellContent = '';
                } else {
                    // We're in a multi-line quoted cell, add a newline and continue
                    cellContent += '\n';
                }
            }
            
            // Add any remaining row if we ended in the middle of one
            if (currentRow.length > 0 || cellContent) {
                currentRow.push(cellContent);
                rows.push(currentRow);
            }
            
            return rows.filter(row => row.some(cell => cell.trim() !== ''));
        }

        function processClipboardData(clipboardText) {
            try {
                // Parse the tab-separated data properly handling multi-line cells
                const rows = parseTabSeparatedData(clipboardText);
                
                // Process each row: add empty column at start, keep first 3 columns and insert 22 empty columns between 2nd and 3rd
                const processedRows = rows.map(row => {
                    // Get first 3 columns (or empty strings if they don't exist)
                    const col1 = row[0] || '';
                    const col2 = row[1] || '';
                    const col3 = row[2] || '';
                    
                    // Create an array of 22 empty strings
                    const emptyColumns = Array(20).fill('');
                    
                    // Return array with an empty column at the start, then col1, col2, 22 empty columns, then col3
                    return ['', col1, col2, ...emptyColumns, col3];
                });
                
                return processedRows;
                
            } catch (error) {
                console.error('Error processing clipboard data:', error);
                return null;
            }
        }

        // Convert processed data back to tab-separated string
        function convertToTabSeparated(processedData) {
            return processedData.map(row => row.join('\t')).join('\n');
        }

        // Display functions
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function displayResult(data) {
            const output = document.getElementById('output');
            if (data && data.length > 0) {
                const tabSeparated = convertToTabSeparated(data);
                output.textContent = tabSeparated;
                showStatus(`Successfully processed ${data.length} rows. Result displayed below.`, 'success');
            } else {
                output.textContent = 'No data to display';
                showStatus('No valid data found to process.', 'error');
            }
        }

        // Main processing function
        async function processFromClipboard() {
            try {
                showStatus('Reading clipboard...', 'info');
                const clipboardText = await navigator.clipboard.readText();
                
                if (!clipboardText.trim()) {
                    showStatus('Clipboard is empty.', 'error');
                    return null;
                }
                
                const processedData = processClipboardData(clipboardText);
                
                if (processedData) {
                    processedResult = processedData;
                    displayResult(processedData);
                    console.log('Processed data:', processedData);
                    return processedData;
                } else {
                    showStatus('Failed to process clipboard data.', 'error');
                    return null;
                }
            } catch (err) {
                console.error('Failed to read clipboard:', err);
                showStatus('Failed to read clipboard. Make sure to grant clipboard permissions.', 'error');
                    return null;
                }
            }

        // Test function with sample data
        function testProcessClipboardData() {
            showStatus('Processing test data...', 'info');
            
            // Example tab-separated data
            const testData = `Col1\tCol2\tCol3\tCol4\tCol5
Value1\tValue2\tValue3\tValue4\tValue5
"Multi
Line"\tCell2\tCell3\tCell4\tCell5
Another\tRow\tHere\tExtra1\tExtra2`;
            
            const result = processClipboardData(testData);
            
            if (result) {
                processedResult = result;
                displayResult(result);
                console.log('Test result:', result);
                return result;
            } else {
                showStatus('Failed to process test data.', 'error');
                return null;
            }
        }

        // Copy result to clipboard
        async function copyResultToClipboard() {
            if (!processedResult) {
                showStatus('No processed data to copy. Process some data first.', 'error');
                return;
            }
            
            try {
                const tabSeparated = convertToTabSeparated(processedResult);
                await navigator.clipboard.writeText(tabSeparated);
                showStatus('Result copied to clipboard successfully!', 'success');
            } catch (err) {
                console.error('Failed to copy to clipboard:', err);
                showStatus('Failed to copy to clipboard.', 'error');
            }
        }

        // Event listeners
        document.getElementById('btnProcess').addEventListener('click', processFromClipboard);
        document.getElementById('btnTest').addEventListener('click', testProcessClipboardData);
        document.getElementById('btnCopy').addEventListener('click', copyResultToClipboard);
    </script>
</body>
</html>